<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Infer barcode sequences from raw reads — infer_barcodes • DadaNanoBC</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Infer barcode sequences from raw reads — infer_barcodes"><meta name="description" content="Applies a clustering workflow to the provided raw reads, based on
DADA2 denoising and/or fixed-threshold clustering to infer the correct
barcode sequence(s). Further groups the resulting sequences by putative
taxon."><meta property="og:description" content="Applies a clustering workflow to the provided raw reads, based on
DADA2 denoising and/or fixed-threshold clustering to infer the correct
barcode sequence(s). Further groups the resulting sequences by putative
taxon."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DadaNanoBC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/basecalling.html">Basecalling</a></li>
    <li><a class="dropdown-item" href="../articles/curation.html">Sequence curation</a></li>
    <li><a class="dropdown-item" href="../articles/lab.html">Lab methods</a></li>
    <li><a class="dropdown-item" href="../articles/primers.html">Primer design</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">Workflow steps</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../analysis-example.html">Example Report</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Infer barcode sequences from raw reads</h1>

      <div class="d-none name"><code>infer_barcodes.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Applies a clustering workflow to the provided raw reads, based on
DADA2 denoising and/or fixed-threshold clustering to infer the correct
barcode sequence(s). Further groups the resulting sequences by putative
taxon.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">infer_barcodes</span><span class="op">(</span></span>
<span>  <span class="va">fq</span>,</span>
<span>  <span class="va">dada_err</span>,</span>
<span>  <span class="va">alignment_prefix</span>,</span>
<span>  id_prefix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tmp_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dada_omega_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-20</span>, <span class="fl">1e-10</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>  omegaA_iter_threshold <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  dada_min_identical <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dada_min_n0 <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  min_seq_abund <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_sample_depth <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  consensus_max_depth <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  consensus_threshold <span class="op">=</span> <span class="fl">0.65</span>,</span>
<span>  consensus_by_qual <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  homopoly_fix_min_ident <span class="op">=</span> <span class="va">dada_min_identical</span>,</span>
<span>  min_homopoly_len <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  fixed_cluster_threshold <span class="op">=</span> <span class="fl">0.97</span>,</span>
<span>  taxa_cluster_threshold <span class="op">=</span> <span class="va">fixed_cluster_threshold</span>,</span>
<span>  cluster_single_linkage <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_variant_freq <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  split_min_identical <span class="op">=</span> <span class="va">dada_min_identical</span>,</span>
<span>  max_split_ratio <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fq">fq<a class="anchor" aria-label="anchor" href="#arg-fq"></a></dt>
<dd><p>demultiplexed FASTQ file</p></dd>


<dt id="arg-dada-err">dada_err<a class="anchor" aria-label="anchor" href="#arg-dada-err"></a></dt>
<dd><p>output from <code><a href="https://rdrr.io/pkg/dada2/man/learnErrors.html" class="external-link">dada2::learnErrors()</a></code></p></dd>


<dt id="arg-alignment-prefix">alignment_prefix<a class="anchor" aria-label="anchor" href="#arg-alignment-prefix"></a></dt>
<dd><p>Optional output prefix for BAM alignment files and
FASTA references for manual inspection and/or downstream analyses</p></dd>


<dt id="arg-id-prefix">id_prefix<a class="anchor" aria-label="anchor" href="#arg-id-prefix"></a></dt>
<dd><p>Name prefix for sequence IDs in the consensus FASTA and BAM alignment files</p></dd>


<dt id="arg-tmp-dir">tmp_dir<a class="anchor" aria-label="anchor" href="#arg-tmp-dir"></a></dt>
<dd><p>Optional path to a temporary directory (default is <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>)</p></dd>


<dt id="arg-dada-omega-a">dada_omega_a<a class="anchor" aria-label="anchor" href="#arg-dada-omega-a"></a></dt>
<dd><p>OMEGA_A parameter value(s) to use for the denoising
(see ?dada2::setDadaOpt):
Can be a vector of increasing values (the default), which are tried
sequentially until a grouping with well-separated haplotypes and
non-ambiguous consensus sequence(s) is found for the <em>top taxon</em>
(<em>note</em>: others currently ignored)</p></dd>


<dt id="arg-omegaa-iter-threshold">omegaA_iter_threshold<a class="anchor" aria-label="anchor" href="#arg-omegaa-iter-threshold"></a></dt>
<dd><p>Only evaluate multiple <code>dada_omega_a</code> values if the
read depth is not larger than the given threshold. For large samples, it is
better to avoid multiple denoising rounds, and it is anyway likely that DADA2
will already find all sequence variants in the first round (with lowest OMEGA_A).
Haplotype variation with InDels may still be found with 'try_split_haplotypes',
but not with DADA2 denoising at high sensitivity.</p></dd>


<dt id="arg-dada-min-identical">dada_min_identical<a class="anchor" aria-label="anchor" href="#arg-dada-min-identical"></a></dt>
<dd><p>Minimum number of identical sequences required to do a
DADA2 denoising. Below this threshold, switch to simple fixed-threshold
clustering instead (at <code>fixed_cluster_threshold</code>) and report the consensus
without further attempting any haplotype splitting.</p></dd>


<dt id="arg-dada-min-n-">dada_min_n0<a class="anchor" aria-label="anchor" href="#arg-dada-min-n-"></a></dt>
<dd><p>Minimum number of error-free reads needed to retain the DADA2 clustering
(<code>n0</code> in dada-class $clustering information).
Switch to fixed-threshold clustering + consensus method below this threshold
(see <code>fixed_cluster_threshold</code>).
<em>Note</em>: <em>error-free</em> does not mean <em>identical</em>, as DADA2 only considers
substitutions, and there can still be InDels, so <code>n0</code> is always equal or higher
to the number of identical sequences.</p></dd>


<dt id="arg-min-seq-abund">min_seq_abund<a class="anchor" aria-label="anchor" href="#arg-min-seq-abund"></a></dt>
<dd><p>minimum number of supporting reads needed for any barcode
sequence variant to be included in the results</p></dd>


<dt id="arg-max-sample-depth">max_sample_depth<a class="anchor" aria-label="anchor" href="#arg-max-sample-depth"></a></dt>
<dd><p>read a maximum of <code>max_sample_depth</code> demultiplexed reads
from the input file (<code>fq</code>) for the denoising/clustering</p></dd>


<dt id="arg-consensus-max-depth">consensus_max_depth<a class="anchor" aria-label="anchor" href="#arg-consensus-max-depth"></a></dt>
<dd><p>maximum number sequences mapped against the
clusters to infer the consensus sequence (if there are more, a random sample
is taken)</p></dd>


<dt id="arg-consensus-threshold">consensus_threshold<a class="anchor" aria-label="anchor" href="#arg-consensus-threshold"></a></dt>
<dd><p>require at least the given proportion of bases
to be identical at every alignment column for an unambiguous consensus call
(values below the default 60% might be problematic)</p></dd>


<dt id="arg-consensus-by-qual">consensus_by_qual<a class="anchor" aria-label="anchor" href="#arg-consensus-by-qual"></a></dt>
<dd><p>Consider the read quality scores when building the
consensus with <a href="https://www.htslib.org/doc/samtools-consensus.html" class="external-link">samtools consensus</a>.
If <code>TRUE</code>, the relative base frequencies are weighted by the Phred quality scores.</p></dd>


<dt id="arg-homopoly-fix-min-ident">homopoly_fix_min_ident<a class="anchor" aria-label="anchor" href="#arg-homopoly-fix-min-ident"></a></dt>
<dd><p>Minimum number of identical sequences required to
attempt adjusting ambiguous homopolymer sequences in the consensus.
The homopolymer run length of the most frequent sequence is chosen.</p></dd>


<dt id="arg-min-homopoly-len">min_homopoly_len<a class="anchor" aria-label="anchor" href="#arg-min-homopoly-len"></a></dt>
<dd><p>Minimum length a homopolymer region needs to have in order
to attempt "fixing" an ambiguous consensus in that region
(see also <code>homopoly_fix_min_ident</code>)</p></dd>


<dt id="arg-fixed-cluster-threshold">fixed_cluster_threshold<a class="anchor" aria-label="anchor" href="#arg-fixed-cluster-threshold"></a></dt>
<dd><p>Similarity threshold for grouping sequence variants
per taxon. Single-linkage clustering is applied, with the default threshold of
0.97, the maximum divergence between any two sequences can be 3%.</p></dd>


<dt id="arg-taxa-cluster-threshold">taxa_cluster_threshold<a class="anchor" aria-label="anchor" href="#arg-taxa-cluster-threshold"></a></dt>
<dd><p>Similarity threshold
and for post-clustering of DADA2 ASVs to group potential haplotypes of the
same sequenced organism together.</p></dd>


<dt id="arg-cluster-single-linkage">cluster_single_linkage<a class="anchor" aria-label="anchor" href="#arg-cluster-single-linkage"></a></dt>
<dd><p>Whether to apply single-linkage fixed-threshold
clustering for low-depth samples.
Clusters grow as long as any two sequences have at least <code>fixed_cluster_threshold</code>
similarity. If <code>FALSE</code>, the all cluster members are compared to one centroid
sequence and remain more concise (=complete-linkage clustering).
On (<code>TRUE</code>) by default, as this appears to work well for low-coverage samples.</p></dd>


<dt id="arg-min-variant-freq">min_variant_freq<a class="anchor" aria-label="anchor" href="#arg-min-variant-freq"></a></dt>
<dd><p>frequency threshold to consider separate sequences (ASVs)
of the same taxon (as clustered with <code>taxa_cluster_threshold</code>) as "real" polymorphisms
(haplotypes), not noise.</p></dd>


<dt id="arg-split-min-identical">split_min_identical<a class="anchor" aria-label="anchor" href="#arg-split-min-identical"></a></dt>
<dd><p>min. number of identical sequences that needs to
support <em>both</em> of top two unique sequences in a sample in order to attempt
haplotype splitting (with these sequences as new references).</p></dd>


<dt id="arg-max-split-ratio">max_split_ratio<a class="anchor" aria-label="anchor" href="#arg-max-split-ratio"></a></dt>
<dd><p>only split an ASV into 2 parental haplotypes if the ratio
of larger:smaller is up to <code>max_split_ratio</code>.
While the haplotypes might not always have an exact 1:1 ratio, this
constraint still enforces a certain balancing of haplotype abundances.
More unbalanced ratios are only possible if DADA2 is rerun with higher sensitivity
(see <code>dada_omega_a</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a data frame with at least the following columns:</p><ul><li><p><em>id</em>: Descriptive sequence ID, e.g.: 'taxon1_seq2'</p></li>
<li><p><em>full_id</em>: The ID used in the BAM and FASTA output files: <em>id</em> prefixed with <code>id_prefix</code></p></li>
<li><p><em>taxon_num</em>: Nth (putative) taxon (integer; see also <code>taxa_cluster_threshold</code>)</p></li>
<li><p><em>sequence</em>: DADA2 ASV or most abundant unique split sequence
(<code>NA</code> in case of fixed-threshold clustering)</p></li>
<li><p><em>consensus</em>: consensus sequence of haplotype member sequences</p></li>
<li><p><em>consensus_ambigs</em>: number of ambiguous bases in the consensus (see <code>consensus_threshold</code>)</p></li>
<li><p><em>consensus_diffs</em>: edit distance between consensus and the representative sequence
(DADA2 ASV) or dominant sequence (after haplotype splitting/fixed-threshold clustering)</p></li>
<li><p><em>homopolymer_adjustments</em>: number of homopolymer locations that were "fixed"
by inferring the repeat number from the most abundant sequence instead of relying
on the consensus (containing Ns)</p></li>
<li><p><em>abundance</em>: number of reads clustering with the given sequence
(up to <code>max_sample_depth</code>)</p></li>
<li><p><em>n_mapped</em>: number of reads mapped to the barcode sequences
(usually the same or very similar to <em>abundance</em>)</p></li>
<li><p><em>n0</em> from DADA2: number of error-free reads (no substitutions, there may still be InDels)</p></li>
<li><p><em>max_identical</em>: max. number of identical reads</p></li>
<li><p><em>method</em>: method from which the haplotype emerged:
one of 'dada', 'dada_split' (if haplotype splitting was done), 'fixed_cluster'</p></li>
<li><p><em>is_rare</em>: <code>TRUE</code> if the relative frequency of a sequence within the same
putative taxon is below <code>min_variant_freq</code></p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Markus Schlegel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

